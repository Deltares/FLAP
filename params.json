{"name":"Flap","tagline":"Fortran command Line Arguments Parser for poor men","body":"[![Ready in backlog](https://badge.waffle.io/szaghi/FLAP.png?label=ready&title=Ready)](https://waffle.io/szaghi/FLAP)\r\n[![In Progress](https://badge.waffle.io/szaghi/FLAP.png?label=in%20progress&title=In%20Progress)](https://waffle.io/szaghi/FLAP)\r\n[![Open bugs](https://badge.waffle.io/szaghi/FLAP.png?label=bug&title=Open%20Bugs)](https://waffle.io/szaghi/FLAP)\r\n[![Bitdeli Badge](https://d2weczhvl823v0.cloudfront.net/szaghi/flap/trend.png)](https://bitdeli.com/free \"Bitdeli Badge\")\r\n\r\n# FLAP\r\n### <a name=\"top\">FLAP, Fortran command Line Arguments Parser for poor men\r\n\r\nA very simple and stupid tool for building easily nice Command Line Interface for modern Fortran projects.\r\n\r\n### A Taste of FLAP\r\n\r\nRunning the provided test program, __flap_test__, a taste of FLAP is served:\r\n```shell\r\n+--> flap_test, a testing program for FLAP library\r\n+--> Parsing Command Line Arguments\r\n|--> The Command Line Interface (CLI) has the following options\r\n|-->   flap_test  [value] --string value [--integer value] [--real value] [--boolean] [--boolean_val value] [--integer_list value#1 value#2 value#3] [--help] [--version]\r\n|--> Each Command Line Argument (CLA) has the following meaning:\r\n|-->   [value]\r\n|-->     Positional real input\r\n|-->     It is a positional CLA having position \"1-th\"\r\n|-->     It is a optional CLA which default value is \"1.0\"\r\n|-->   [--string value] or [-s value]\r\n|-->     String input\r\n|-->     It is a non optional CLA thus must be passed to CLI\r\n|-->   [--integer value] or [-i value] with value chosen in: (1,3,5)\r\n|-->     Integer input with fixed range\r\n|-->     It is a optional CLA which default value is \"1\"\r\n|-->   [--real value] or [-r value]\r\n|-->     Real input\r\n|-->     It is a optional CLA which default value is \"1.0\"\r\n|-->   [--boolean] or [-b]\r\n|-->     Boolean input\r\n|-->     It is a optional CLA which default value is \".false.\"\r\n|-->   [--boolean_val value] or [-bv value]\r\n|-->     Valued boolean input\r\n|-->     It is a optional CLA which default value is \".true.\"\r\n|-->   [--integer_list value#1 value#2 value#3] or [-il value#1 value#2 value#3]\r\n|-->     Integer list input\r\n|-->     It is a optional CLA which default value is \"1 8 32\"\r\n|-->   [--help] or [-h]\r\n|-->     Print this help message\r\n|-->     It is a optional CLA\r\n|-->   [--version] or [-v]\r\n|-->     Print version\r\n|-->     It is a optional CLA\r\n|--> Usage examples:\r\n|-->   -) flap_test -s 'Hello FLAP'\r\n|-->   -) flap_test -s 'Hello FLAP' -i -2 # printing error...\r\n|-->   -) flap_test -s 'Hello FLAP' -i 3 -r 33.d0\r\n|-->   -) flap_test -s 'Hello FLAP' -integer_list 10 -3 87\r\n|-->   -) flap_test 33.0 -s 'Hello FLAP' -i 5\r\n|-->   -) flap_test -string 'Hello FLAP' -boolean\r\n```\r\nNot so bad for just a very few statements as the following:\r\n```fortran\r\n...\r\nwrite(stdout,'(A)')'+--> flap_test, a testing program for FLAP library'\r\n! initializing CLI\r\ncall cli%init(progname='flap_test',                                           &\r\n              version ='v0.0.1',                                              &\r\n              examples=[\"flap_test -s 'Hello FLAP'                          \",&\r\n                        \"flap_test -s 'Hello FLAP' -i -2 # printing error...\",&\r\n                        \"flap_test -s 'Hello FLAP' -i 3 -r 33.d0            \",&\r\n                        \"flap_test -s 'Hello FLAP' -integer_list 10 -3 87   \",&\r\n                        \"flap_test 33.0 -s 'Hello FLAP' -i 5                \",&\r\n                        \"flap_test -string 'Hello FLAP' -boolean            \"])\r\n! setting CLAs\r\ncall cli%add(pref='|-->',switch='--string',      switch_ab='-s', help='String input',                  required=.true., act='store',                                  error=error)\r\ncall cli%add(pref='|-->',switch='--integer',     switch_ab='-i', help='Integer input with fixed range',required=.false.,act='store',          def='1',choices='1,3,5',error=error)\r\ncall cli%add(pref='|-->',switch='--real',        switch_ab='-r', help='Real input',                    required=.false.,act='store',          def='1.0',              error=error)\r\ncall cli%add(pref='|-->',switch='--boolean',     switch_ab='-b', help='Boolean input',                 required=.false.,act='store_true',     def='.false.',          error=error)\r\ncall cli%add(pref='|-->',switch='--boolean_val', switch_ab='-bv',help='Valued boolean input',          required=.false.,act='store',          def='.true.',           error=error)\r\ncall cli%add(pref='|-->',switch='--integer_list',switch_ab='-il',help='Integer list input',            required=.false.,act='store',nargs='3',def='1 8 32',           error=error)\r\ncall cli%add(pref='|-->',positional=.true.,position=1,           help='Positional real input',         required=.false.,                      def='1.0',              error=error)\r\n! parsing CLI\r\nwrite(stdout,'(A)')'+--> Parsing Command Line Arguments'\r\ncall cli%parse(error=error,pref='|-->')\r\n...\r\n```\r\nFor a practical example of FLAP usage see [POG](https://github.com/szaghi/OFF/blob/testing/src/POG.f90) source file at line `85`.\r\n\r\nGo to [Top](#top) or [Toc](#toc)\r\n## <a name=\"toc\">Table of Contents\r\n\r\n* [Team Members](#team-members)\r\n* [What is FLAP?](#what)\r\n* [Main features](#main-features)\r\n* [Todos](#todos)\r\n* [Requirements](#requirements)\r\n* [Copyrights](#copyrights)\r\n* [Usage](#usage)\r\n  + [API](#API)\r\n      * [Initializing CLI with personalized help messages](#cli-init)\r\n      * [Adding a new CLA to CLI](#cla-add)\r\n      * [Parsing the CLI](#cli-parse)\r\n      * [Getting a CLA value from parsed CLI](#cla-get)\r\n  + [Compile Testing Program](#test)\r\n* [Version History](#versions)\r\n\r\nGo to [Top](#top) or [Toc](#toc)\r\n## <a name=\"team-members\"></a>Team Members\r\n* Stefano Zaghi <stefano.zaghi@gmail.com>\r\n\r\nGo to [Top](#top) or [Toc](#toc)\r\n## <a name=\"what\"></a>What is FLAP?\r\n\r\nModern Fortran standards (2003+) have introduced support for Command Line Arguments (CLA), thus it is possible to construct nice and effective Command Line Interface (CLI). FLAP is a small library designed to simplify the (repetitive) construction of complicated CLI in pure Fortran (standard 2003+). FLAP has been inspired by the python module _argparse_ trying to mimic it. Once you have defined the arguments are required by means of a user-friendly method of the CLI, FLAP will parse the CLAs for you. It is worthy of note that FLAP, as _argparse_, also automatically generates help and usage messages and issues errors when users give the program invalid arguments.\r\n\r\nGo to [Top](#top) or [Toc](#toc)\r\n## <a name=\"main-features\"></a>Main features\r\n+ User-friendly methods for building flexible and effective Command Line Interfaces (CLI);\r\n+ support optional and non optional Command Line Argument (CLA);\r\n+ support boolean CLA;\r\n+ support positional CLA;\r\n+ support list of allowable values for defined CLA with automatic consistency check;\r\n+ support multiple valued (list of values) CLA;\r\n+ automatic generation of help and usage messages;\r\n+ self-consistency-check of CLA definition;\r\n+ consistency-check of whole CLI definition;\r\n+ errors trapping for invalid CLI usage;\r\n\r\nGo to [Top](#top) or [Toc](#toc)\r\n## <a name=\"todos\"></a>Todos\r\n+ Try [docopt](https://github.com/docopt/docopt) features;\r\n+ any feature request is welcome!\r\n\r\nGo to [Top](#top) or [Toc](#toc)\r\n## <a name=\"requirements\"></a>Requirements\r\n+ Modern Fortran Compiler (standard 2003+);\r\n+ a lot of patience with the author.\r\n\r\nFLAP is developed on a GNU/Linux architecture. For Windows architecture there is no support, however it should be work out-of-the-box.\r\n\r\nGo to [Top](#top) or [Toc](#toc)\r\n## <a name=\"Copyrights\"></a>Copyrights\r\n\r\nFLAP is an open source project, it is distributed under the [GPL v3](http://www.gnu.org/licenses/gpl-3.0.html). Anyone is interest to use, to develop or to contribute to FLAP is welcome.\r\n\r\nGo to [Top](#top) or [Toc](#toc)\r\n## <a name=\"usage\"></a>Usage\r\nFLAP is a module library.\r\nFLAP is currently composed by one module, namely  __Data_Type_Command_Line_Interface.f90__, where two derived types are defined: \r\n1. __Type_Command_Line_Argument__;\r\n2. __Type_Command_Line_Interface__. \r\n\r\nThe first one is a back-end handling CLAs while the latter is the front-end providing all you need to handle your CLI. Two auxiliary modules, __IR_Precision.f90__ and __Lib_IO_Misc.f90__ are used for minor tasks. Finally, a testing program __flap_test__ is provided showing a basic example of FLAP usage.\r\n\r\nTo start using FLAP and declaring your CLI, you must import its main module:\r\n```fortran\r\n...\r\nUSE Data_Type_Command_Line_Interface\r\n...\r\n\r\ntype(Type_Command_Line_Interface):: CLI\r\n```\r\nNow that you have your CLI declared you can start using it. The API to handle it follows.\r\n\r\n### <a name=\"API\">API\r\nThe main CLI object, that is the only one you must know, is __Type_Command_Line_Interface__\r\n```fortran\r\ntype, public:: Type_Command_Line_Interface\r\n  integer(I4P)::                                  Na          = 0_I4P !< Number of CLA.\r\n  integer(I4P)::                                  Na_required = 0_I4P !< Number of command line arguments that CLI requires.\r\n  integer(I4P)::                                  Na_optional = 0_I4P !< Number of command line arguments that are optional for CLI.\r\n  type(Type_Command_Line_Argument), allocatable:: cla(:)              !< CLA list [1:Na].\r\n  character(len=:), allocatable::                 progname            !< Program name.\r\n  character(len=:), allocatable::                 version             !< Program version.\r\n  character(len=:), allocatable::                 help                !< Help message introducing the CLI usage.\r\n  character(len=:), allocatable::                 examples(:)         !< Examples of correct usage.\r\n  logical::                                       disable_hv = .false.!< Disable automatic inserting of 'help' and 'version' CLAs.\r\n  contains\r\n    procedure:: free                                ! Procedure for freeing dynamic memory.\r\n    procedure:: init                                ! Procedure for initializing CLI.\r\n    procedure:: add                                 ! Procedure for adding CLA to CLAs list.\r\n    procedure:: check                               ! Procedure for checking CLAs data consistenc.\r\n    procedure:: passed                              ! Procedure for checking if a CLA has been passed.\r\n    procedure:: parse                               ! Procedure for parsing Command Line Interfaces.\r\n    generic::   get => get_cla_cli,get_cla_list_cli ! Procedure for getting CLA value(s) from CLAs list parsed.\r\n    final::     finalize                            ! Procedure for freeing dynamic memory when finalizing.\r\n    ! operators overloading\r\n    generic:: assignment(=) => assign_cli\r\n    ! private procedures\r\n    procedure,              private:: get_cla_cli\r\n    procedure,              private:: get_cla_list_cli\r\n    procedure, pass(self1), private:: assign_cli\r\nendtype Type_Command_Line_Interface\r\n```\r\nFews methods are provided within this derived type:\r\n\r\n+ _free_ for freeing the CLI memory;\r\n+ _init_ for initializing CLI with user defined help messages; \r\n+ _add_ for adding a CLA to the CLI; \r\n+ _check_ for checking the CLAs definition consistency;\r\n+ _passed_ for checking is a particular CLA has been actually passed; \r\n+ _parse_ for parsing all passed CLAs accordingly to the list previously defined for building up the CLI;\r\n+ _get_ for returning a particular CLA value and storing it into user-defined variable.\r\n\r\nEssentially, for building up and using a minimal CLI you should follow the 4 steps:\r\n\r\n1. declare a CLI variable:\r\n```fortran\r\ntype(Type_Command_Line_Interface):: cli\r\n```\r\n2. adding one or more CLA definition to the CLI:\r\n```fortran\r\ncall cli%add(switch='-o',help='Output file name',def='myfile.md',error=error)\r\n```\r\nmore details on how declare a CLA are reported in the followings;\r\n3. parsing the actually passed command line arguments:\r\n```fortran\r\ncall cli%parse(error=error)\r\n```\r\nmore details on parsing method are reported in the followings;\r\n4. getting parsed values and storing into user-defined variables:\r\n```fortran\r\ncall cli%get(switch='-o',val=OutputFilename,error=error)\r\n```\r\n_OutputFilename_ and _error_ being previously defined variables. \r\n\r\nOptionally you can initialize CLI with custom help messages by means of _init_ method.\r\n\r\n#### <a name=\"cli-init\">Initializing CLI with personalized help messages\r\n\r\nCLI data type can already (quasi-automatically) handle CLAs through its default values (provided from the baseline variable declaration, i.e. `type(Type_Command_Line_Interface):: cli`). However, in order to improve the clearness CLI messages you can personalized help messages by means of _init_ method (that remains an optional step):\r\n```fortran\r\ncall cli%init(progname,version,help,examples,disable_hv)\r\n```\r\nwhere\r\n```fortran\r\ncharacter(*), optional, intent(IN):: progname     !< Program name.\r\ncharacter(*), optional, intent(IN):: version      !< Program version.\r\ncharacter(*), optional, intent(IN):: help         !< Help message introducing the CLI usage.\r\ncharacter(*), optional, intent(IN):: examples(1:) !< Examples of correct usage.\r\nlogical,      optional, intent(IN):: disable_hv   !< Disable automatic inserting of 'help' and 'version' CLAs.\r\n```\r\nThe dummy arguments should be auto-explicative. Note that the _help_ and _examples_ dummy arguments are used for printing a pretty help message explaining the CLI usage, thus should be always provided even if they are optional arguments. Moreover, due the Fortran limitations, the array containing the examples must have character elements with the same length, thus trailing white spaces must padded to short examples.\r\n\r\nThe only not so clear argument of _init_ method is __disable_hv__.\r\n\r\n###### Disabling automatic Help and Version\r\nFLAP automatically add 2 special CLA to CLI:\r\n\r\n1. a CLA for printing a help message explaining the correct use of the CLI;\r\n2. a CLA for printing the version (if defined when the CLI is initialized) of the program.\r\n\r\nThis two CLAs has the following default switches:\r\n\r\n+ _help_: switch `--help`, abbreviated switch `-h`;\r\n+ _version_: switch `--version`, abbreviated switch `-v`;\r\n\r\nHowever, FLAP before adding these two CLAs to the CLI checks if these switches have been already used and in case does not add them. To disable such an automatic CLAs creation initialized the CLI with:\r\n```fortran\r\ncall cli%init(...,disable_hv=.true.)\r\n```\r\n\r\nGo to [Top](#top) or [Toc](#toc)\r\n#### <a name=\"cla-add\">Adding a new CLA to CLI\r\n\r\nCLA cannot be directly defined and modified: to handle a CLA you must use CLI methods. Adding CLA to CLI is performed through the _add_ method:\r\n```fortran\r\n  call cli%add(pref,switch,switch_ab,help,required,positional,position,act,def,nargs,choices,error)\r\n```\r\nwhere\r\n```fortran\r\ncharacter(*), optional, intent(IN)::  pref       !< Prefixing string.\r\ncharacter(*), optional, intent(IN)::  switch     !< Switch name.\r\ncharacter(*), optional, intent(IN)::  switch_ab  !< Abbreviated switch name.\r\ncharacter(*), optional, intent(IN)::  help       !< Help message describing the CLA.\r\nlogical,      optional, intent(IN)::  required   !< Flag for set required argument.\r\nlogical,      optional, intent(IN)::  positional !< Flag for checking if CLA is a positional or a named CLA.\r\ninteger(I4P), optional, intent(IN)::  position   !< Position of positional CLA.\r\ncharacter(*), optional, intent(IN)::  act        !< CLA value action.\r\ncharacter(*), optional, intent(IN)::  def        !< Default value.\r\ncharacter(*), optional, intent(IN)::  nargs      !< Number of arguments consumed by CLA.\r\ncharacter(*), optional, intent(IN)::  choices    !< List of allowable values for the argument.\r\ninteger(I4P),           intent(OUT):: error      !< Error trapping flag.\r\n```\r\nThe dummy arguments should be auto-explicative. Note that the _help_ dummy argument is used for printing a pretty help message explaining the CLI usage, thus should be always provided even if CLA is an optional argument. It is also worthy of note that the abbreviated switch is set equal to switch name (if passed) if no otherwise defined. Moreover, one between _switch_ and _position_ must be defined: if _switch_ is defined then a named CLA is initialed, otherwise _position_ must be defined (with _positional=.true._) and a positional CLA is initialized. \r\n\r\nThe following rules apply:\r\n+ `pref` string is used as prefixing string for any messages on standard out/err;\r\n+ if `required` is set to `.false.` a default value must be defined, even if it is a null string;\r\n+ no matter the type of CLA value is (real, integer, etc...) the definition of default value for an optional CLA must be always a string, e.g. `def='1'` or `def='1.0'`; the actual type casting is performed when the CLA value is gotten by means of the `get` method: the type casting is performed by means of the actual type (and kind) of the variable used for storing CLA value;\r\n+ presently the possible actions of CLA are (all actions definitions are case insensitive):\r\n    + `act=store`, the CLA stores a value that must be passed after the CLA switch for named CLA;\r\n    + `act=store_true`, the CLA stores `.true.`;\r\n    + `act=store_false`, the CLA stores `.false.`;\r\n    + `act=print_help`, the CLA triggers the printing of the help message that is built with the help messages of all defined CLAs and the help message of CLI;\r\n    + `act=print_version`, the CLA triggers the printing the program version; if the version is not defined when the CLI is initialized the message will contain `version unknown`.\r\n\r\n\r\nWhen a CLA is added a self-consistency-check is performed, e.g. it is checked if an optional CLA has a default value or if one of _position_ and _switch_ has been passed. In case the self-consistency-check fails an error code is returned and an error message is printed to _stderr_.\r\n\r\nNote that _choices_  must be a comma-separated list of allowable values and if it has been specified the passed value is checked to be consistent with this list when the _get_ method is invoked: an error code is returned and if the value is not into the specified range an error message is printed to _stderr_. However the value of CLA is not modified and it is equal to the passed value.\r\n\r\nGo to [Top](#top) or [Toc](#toc)\r\n#### <a name=\"cli-parse\">Parsing the CLI\r\nThe complete signature of _parse_ method is the following:\r\n```fortran\r\n  call cli%parse(pref,error)\r\n```\r\nwhere\r\n```fortran\r\ncharacter(*), optional, intent(IN)::  pref  !< Prefixing string.\r\ninteger(I4P),           intent(OUT):: error !< Error trapping flag.\r\n```\r\nThe dummy arguments should be auto-explicative. It is worthy of note that when _parse_ method is invoked a consistency-check is performed: in particular it is checked that all named CLAs (the non positional ones having defined the switch name) have a unique switch name in order to avoid ambiguity.\r\n\r\nThe help messages are print if one of the following issues arise:\r\n- the _help_ CLA is passed;\r\n- the switch name of unknown CLA is passed;\r\n- the number of passed CLAs is less than the required CLAs previously defined.\r\n\r\nGo to [Top](#top) or [Toc](#toc)\r\n#### <a name=\"cla-get\">Getting a CLA value from parsed CLI\r\nAfter the CLI has been parsed, the user is allowed to get any of the defined CLA value. Accordingly to the user-definition, a CLA value can be obtained either by the switch name (for named CLA) or by the CLA position (for positional CLA):\r\n```fortran\r\ncall cli%get(switch='-r',val=rval,error=err)\r\n```\r\nor\r\n```fortran\r\ncall cli%get(position=1,val=prval,error=err)\r\n```\r\nwhere _rval_ and _prval_ are two previously defined variables. Currently, the _val_ variable can be only scalar of types _integer_, _real_, _logical_ and _character_. The complete API of _cli%get_ is the following:\r\n```fortran\r\ncall cli%get(pref,switch,position,val,error)\r\n```\r\nwhere the signature of  _get_ is:\r\n```fortran\r\ncharacter(*), optional, intent(IN)::    pref     !< Prefixing string.\r\ncharacter(*), optional, intent(IN)::    switch   !< Switch name.\r\ninteger(I4P), optional, intent(IN)::    position !< Position of positional CLA.\r\nclass(*),               intent(INOUT):: val      !< CLA value.\r\ninteger(I4P),           intent(OUT)::   error    !< Error trapping flag.\r\n```\r\nThe dummy arguments should be auto-explicative. Note that the _switch_ passed can be also the abbreviated form if defined differently from the extended one. If no _switch_ neither _position_ is passed and error is arisen. Moreover, the type of the value returned is chosen accordingly to actual _val_ argument passed: inside the _get_ method _val_ is an unlimited polymorphic variable which type is defined only when the user passes the actual _val_ container.\r\n\r\nNote that for multiple valued (list) CLA, the _get_ method accept also array _val_:\r\n```fortran\r\ncharacter(*), optional, intent(IN)::    pref     !< Prefixing string.\r\ncharacter(*), optional, intent(IN)::    switch   !< Switch name.\r\ninteger(I4P), optional, intent(IN)::    position !< Position of positional CLA.\r\nclass(*),               intent(INOUT):: val(1:)  !< CLA value.\r\ninteger(I4P),           intent(OUT)::   error    !< Error trapping flag.\r\n```\r\nhowever, the _get_ method is invoked exactly with the same signature of single valued CLA as above: _get_ is a generic, user-friendly method that automatically handles both scalar and array _val_ variables.\r\n\r\nGo to [Top](#top) or [Toc](#toc)\r\n### <a name=\"test\">Compile Testing Program\r\n\r\nAs a practical example of FLAP usage a testing program named __flap_test__ is provided. You can compile with Fortran compiler supporting modern standards (2003+). Note that the dependency hierarchy of modules USE statement must be respected in order to successfully compile the program. If you are tired by frustrating usage of makefiles & co. you can try [FoBiS.py](https://github.com/szaghi/FoBiS) for building the program. A _fobos_ file is provided with FLAP. To build it just type into the root directory of FLAP:\r\n```bash\r\nFoBiS.py build\r\n```\r\n\r\nGo to [Top](#top) or [Toc](#toc)\r\n## <a name=\"versions\"></a>Version History\r\nIn the following the changelog of most important releases is reported.\r\n### v0.0.1 \r\n##### Download [ZIP](https://github.com/szaghi/FLAP/archive/v0.0.1.zip) ball or [TAR](https://github.com/szaghi/FLAP/archive/v0.0.1.tar.gz) one\r\nStable Release. Fully backward compatible. \r\n\r\nGo to [Top](#top) or [Toc](#toc)\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}